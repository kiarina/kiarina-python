#!/usr/bin/env bash
#MISE description="Publish <package> to PyPI"
#USAGE arg "<package>" help="Package name (e.g. 'kiarina-utils-common')"
#USAGE flag "-t --test" help="Publish to Test PyPI instead of PyPI"

set -euo pipefail

package="$usage_package"
test_pypi="${usage_test:-false}"

# Package name validation
if [ ! -d "packages/$package" ]; then
    echo "âŒ Package not found: $package"
    exit 1
fi

echo "ðŸ“¦ Publishing $package..."

# Navigate to the package directory
cd "packages/$package"

# Publish command
if [ "$test_pypi" = "true" ]; then
    echo "ðŸ§ª Publishing to Test PyPI..."
    uv publish --repository testpypi
    echo "âœ… $package published to Test PyPI successfully!"
    echo "ðŸ”— Check your package at: https://test.pypi.org/project/$package/"
else
    echo "ðŸš€ Publishing to PyPI..."
    uv publish
    echo "âœ… $package published to PyPI successfully!"
    echo "ðŸ”— Check your package at: https://pypi.org/project/$package/"
fi

cd - > /dev/null
